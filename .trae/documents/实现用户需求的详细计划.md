# 实现用户需求的详细计划

## 1. JSON保存位置确保在Client文件夹内
- **现状**：当前JSON文件保存在配置的results_dir中，已在Client文件夹内
- **修改点**：确保所有JSON相关操作都使用Client文件夹路径

## 2. 更新Excel的row，更换物料，新建JSON文件
- **修改点**：
  - 在`on_control_data_received`方法中，当处理new_target指令时，确保为每个新物料创建新的JSON文件
  - 优化JSON文件名生成逻辑，确保唯一性

## 3. Excel读取参数后对应更新到UI
- **修改点**：
  - 在`load_excel`方法中，添加将Excel数据更新到参数配置UI的逻辑
  - 添加选择Excel行的功能，允许用户手动选择要处理的物料行
  - 当选择某行时，将该行的密度、颗粒大小、瓶重等参数更新到对应的UI控件

## 4. Excel数据遍历后触发complete状态
- **修改点**：
  - 完善`is_completed`方法的逻辑
  - 在遍历完所有数据后，更新按钮状态，启用开始按钮，禁用停止按钮
  - 添加完成状态的UI提示

## 5. 区分DATA_COM和CTRL_COM日志
- **修改点**：
  - 修改`logger.py`，为不同类型的日志添加不同的颜色标识
  - 在控制台输出时，使用不同颜色区分DATA_COM和CTRL_COM日志

## 6. 添加称重曲线可视化
- **修改点**：
  - 在`init_ui`方法中，将界面布局从两列改为三列
  - 新增第三列用于显示称重曲线
  - 使用PyQtGraph或Matplotlib实现实时曲线绘制
  - 曲线包含时间、目标重量和当前重量三条线
  - 添加数据点存储逻辑，记录每次称重的数据
  - 添加曲线清空和保存功能

## 7. 添加分类批量查看功能
- **修改点**：
  - 添加JSON文件管理界面，显示所有生成的实验结果文件
  - 实现按物料名称、日期、时间等条件筛选功能
  - 实现批量查看和导出功能
  - 添加实验结果统计功能，显示平均值、标准差等统计信息
  - 支持将选中的实验结果导出为Excel或CSV格式
  - 添加实验结果对比功能，可同时查看多个实验的曲线

## 8. 整体界面调整
- **修改点**：
  - 调整各列的宽度比例，确保第三列有足够空间显示曲线
  - 优化布局，确保界面美观易用
  - 添加标签页或分组，合理组织功能模块

## 9. 测试和优化
- **修改点**：
  - 测试所有功能，确保正常工作
  - 优化性能，确保实时曲线绘制流畅
  - 修复可能出现的bug

## 实现顺序
1. 首先修改界面布局，添加第三列用于曲线显示
2. 实现称重曲线绘制功能
3. 完善Excel参数更新到UI的功能
4. 优化JSON文件管理
5. 实现日志区分显示
6. 完善数据遍历完成后的状态处理
7. 实现分类批量查看功能
8. 测试和优化

## 预期效果
- 界面分为三列，前两列保持不变，第三列显示实时称重曲线
- 不同类型的日志在控制台以不同颜色显示
- 从Excel读取的参数自动更新到UI
- 每次更换物料时创建新的JSON文件
- 数据遍历完成后自动更新按钮状态
- 称重曲线实时显示，包含时间、目标重量和当前重量
- 新增实验结果管理界面，支持分类、筛选和批量查看实验数据
- 支持实验结果的统计分析和对比功能